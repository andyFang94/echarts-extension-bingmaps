(function(g,m){typeof exports=="object"&&typeof module<"u"?m(require("echarts")):typeof define=="function"&&define.amd?define(["echarts"],m):(g=typeof globalThis<"u"?globalThis:g||self,m(g.echarts))})(this,function(g){"use strict";function m(t){if(t&&t.__esModule)return t;const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const e in t)if(e!=="default"){const o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,o.get?o:{enumerable:!0,get:()=>t[e]})}}return n.default=t,Object.freeze(n)}const d=m(g),{util:y,graphic:_,matrix:w}=d;function O(t,n){return n=n||[0,0],y.map([0,1],function(e){const o=n[e],i=t[e]/2,c=[],r=[];return c[e]=o-i,r[e]=o+i,c[1-e]=r[1-e]=n[1-e],Math.abs(this.dataToPoint(c)[e]-this.dataToPoint(r)[e])},this)}function h(t,n){this._bingmap=t,this._mapOffset=[0,0],this._api=n}const s=h.prototype;s.setZoom=function(t){this._zoom=t},s.setCenter=function(t){this._center=this._bingmap.tryLocationToPixel(new Microsoft.Maps.Location(t[1],t[0]))},s.setMapOffset=function(t){this._mapOffset=t},s.setBingMap=function(t){this._bingmap=t},s.getBingMap=function(){return this._bingmap},s.dataToPoint=function(t){const n=new Microsoft.Maps.Location(t[1],t[0]),e=this._bingmap.tryLocationToPixel(n,Microsoft.Maps.PixelReference.control),o=this._mapOffset;return[e.x-o[0],e.y-o[1]]},s.pointToData=function(t){const n=this._mapOffset,e=this._bingmap.tryPixelToLocation({x:t[0]+n[0],y:t[1]+n[1]},Microsoft.Maps.PixelReference.control);return[e.longitude,e.latitude]},s.getViewRect=function(){const t=this._api;return new _.BoundingRect(0,0,t.getWidth(),t.getHeight())},s.getRoamTransform=function(){return w.create()},s.prepareCustoms=function(){const t=this.getViewRect();return{coordSys:{type:"bingmap",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:y.bind(this.dataToPoint,this),size:y.bind(O,this)}}},s.convertToPixel=function(t,n,e){return this.dataToPoint(e)},s.convertFromPixel=function(t,n,e){return this.pointToData(e)},h.create=function(t,n){let e;t.eachComponent("bingmap",function(o){if(typeof Microsoft>"u"||typeof Microsoft.Maps>"u"||typeof Microsoft.Maps.Map>"u")throw new Error("Bing Map API has not been loaded completely yet.");if(e)throw new Error("Only one bingmap component is allowed");let i=o.getBingMap();if(!i){const p=n.getDom(),f=n.getZr().painter,l=f.getViewportRoot();l.className="ms-composite",l.style.visibility="hidden";let a=p.querySelector(".ec-extension-bing-map");a&&(l.style.left="0px",l.style.top="0px",p.removeChild(a)),a=document.createElement("div"),a.className="ec-extension-bing-map",a.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;",p.appendChild(a),i=new Microsoft.Maps.Map(a);const b=o.get("mapOption")||{};i.setOptions(b),a.querySelector(".MicrosoftMap").appendChild(l),l.style.visibility="",o.setBingMap(i),o.setEChartsLayer(l),f.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}let c=o.get("viewOption"),{center:r,zoom:u}=c;const M=[r.lng!=null?r.lng:r[0],r.lat!=null?r.lat:r[1]];if(r&&u){const p=i.getCenter(),f=i.getZoom();if(o.centerOrZoomChanged([p.longitude,p.latitude],f)){const a=new Microsoft.Maps.Location(M[1],M[0]);i.setView({center:a,zoom:u})}}e=new h(i,n),e.setMapOffset(o.__mapOffset||[0,0]),e.setZoom(u),e.setCenter(r),o.coordinateSystem=e}),t.eachSeries(function(o){o.get("coordinateSystem")==="bingmap"&&(o.coordinateSystem=e)})},s.dimensions=h.dimensions=["lng","lat"],s.type="bingmap";function C(t,n){return t&&n&&t[0]===n[0]&&t[1]===n[1]}d.extendComponentModel({type:"bingmap",setBingMap:function(t){this.__bingmap=t},getBingMap:function(){return this.__bingmap},setEChartsLayer:function(t){this.__echartsLayer=t},getEChartsLayer:function(){return this.__echartsLayer},setCenterAndZoom:function(t,n){this.option.viewOption.center=t,this.option.viewOption.zoom=n},centerOrZoomChanged:function(t,n){const e=this.option.viewOption;return!(C(t,e.center)&&n===e.zoom)},defaultOption:{viewOption:{center:[113.493471,23.169598],zoom:5},mapOption:{customMapStyle:{}}}}),d.extendComponentView({type:"bingmap",render:function(t,n,e){let o=!0;const i=t.getBingMap(),c=e.getZr().painter.getViewportRoot(),r=t.coordinateSystem,u=function(M){if(o)return;const p=c.parentNode.parentNode.parentNode,f=[-parseInt(p.style.left,10)||0,-parseInt(p.style.top,10)||0];c.style.left=f[0]+"px",c.style.top=f[1]+"px",r.setMapOffset(f),t.__mapOffset=f,e.dispatchAction({type:"bingmapRoam"})};Microsoft.Maps.Events.removeHandler(this._oldViewChangeHandler),this._oldViewChangeHandler=Microsoft.Maps.Events.addHandler(i,"viewchange",u),Microsoft.Maps.Events.removeHandler(this._oldmapresize),this._oldmapresize=Microsoft.Maps.Events.addHandler(i,"mapresize",u),o=!1},dispose(){const t=this.__model;t&&(t.getBingMap().destroy(),t.setBingMap(null),t.setEChartsLayer(null),t.coordinateSystem&&(t.coordinateSystem.setBingMap(null),t.coordinateSystem=null),delete this._oldViewChangeHandler,delete this._oldmapresize)}}),d.registerCoordinateSystem("bingmap",h),d.registerAction({type:"bingmapRoam",event:"bingmapRoam",update:"updateLayout"},function(t,n){n.eachComponent("bingmap",function(e){const o=e.getBingMap(),i=o.getCenter();e.setCenterAndZoom([i.longitude,i.latitude],o.getZoom())})})});
//# sourceMappingURL=echarts-extension-bingmaps.umd.js.map
